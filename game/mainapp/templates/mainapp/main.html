{% extends "base.html" %}
{%load static%}
{% block script %}
<script>
      function preload(){
        this.load.image('dic', "{% static '/resource/ui/main/백과사전.png'%}")
        this.load.image('analysis', "{% static '/resource/ui/main/분석.png'%}")
        this.load.image('store', "{% static '/resource/ui/main/상점.png'%}")
        this.load.image('setting', "{% static '/resource/ui/gear.png'%}")
        this.load.image('skills', "{% static '/resource/ui/main/스킬.png'%}")
        this.load.image('start', "{% static '/resource/ui/main/게임시작.png'%}")
        this.load.image('achievement', "{% static '/resource/ui/main/업적.png'%}")
        this.load.image('namespace', "{% static '/resource/ui/main/namespace.png'%}")
        this.load.image('status', "{% static '/resource/ui/main/status.png'%}")
        this.load.image('background', "{% static '/resource/ui/background.jpg'%}")
        this.load.image('panel', "{% static '/resource/ui/background.jpg'%}")
        this.load.image('toggle', "{% static '/resource/ui/box.png'%}")
        this.load.image('checkmark', "{% static '/resource/ui/checkmark.png'%}")

        this.load.audio('title_music', "{% static '/resource/bgm/title_music.mp3'%}")
      }

      function createButton(text){  
        return this.add.text(
          50,
          50,
          text,
          {
            color:'black',
            fontSize:18,
          }
        );
        return this.add.label({
          background: this.add.rectangle(0, 0, 100, 50, {
            bl: 0,
            br: 0
          }, 0x654321),
          text: this.add.text(0, 0, text, {
            fontSize: '12pt'
          }),
          space: {
            left: 10,
            right: 10,
            top:10,
            bottom:10
          }
        });
      }
      
      function create(){

        const _this = this

        fetch('http://localhost:8000/core/api/user')
        .then((response) => response.json())
        .then((data) => {
          createButton.call(_this, data.username)
          console.log(data)
        });

        this.sound.play("title_music",{
          loop:true
        })
  
        this.add.image(150,300,'background')
        this.add.image(150,130,'status').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(60,220,'dic').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(60,270,'achievement').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(240,530,'start').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(255,440,'store').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(175,465,'skills').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(145,545,'analysis').setScale(0.3).setInteractive({cursor:'pointer'})
        this.add.image(150,30,'namespace').setScale(0.3)
        var setting = this.add.image(270,30,'setting').setInteractive({cursor:'pointer'})
        var panel = this.add.image(150,300,'panel').setScale(0.7)
        var toggle = this.add.image(70, 150, 'toggle').setScale(0.3).setInteractive({cursor:'pointer'})
        var checkmark = this.add.image(70,150,'checkmark').setScale(0.5)
        panel.alpha = 0.7

        var text = this.add.text(
          toggle.x+30,
          toggle.y-7,
          'Sound',
          {
            color:'black',
            fontSize:18,
          }
        )

        this.input.setTopOnly(true)

        this.input.on('gameobjectover', function(pointer, gameObject){
          var link = gameObject.texture.key
            if (String(link)=='toggle'){
              gameObject.setTint(0xe0e0e0)
            }
            else {
              gameObject.setTint(0x50bcdf)
            }
        })

        this.input.on('gameobjectout', function(pointer, gameObject){
            gameObject.clearTint()
        })

        this.input.on('gameobjectdown', function(pointer, gameObject){
            var link = gameObject.texture.key
            if (String(link) == 'setting'){

            }
            else if(String(link) == 'toggle'){
              this.toggleSound()
            }
            else{
              link = 'http://localhost:8000/mainapp/' + String(link)
              location.replace(link)
            }
            
        })

        function toggleSound(){
          let isMute = !this.checkmark.visible

          isMute = !isMute

          this.scene.sound.mute = isMute
          this.checkmark.visible = !isMute
        }

      }
      
      function update(){
        
      }
      
      var config = {
        type: Phaser.AUTO,
        width: 300,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                debug: false,
                gravity: {
                    y: 0
                }
            }
        },
        backgroundColor: '#2d2d2d',
        scene: {
          preload: preload,
          create: create,
          update:update,
        },
        scale: {
            mode: Phaser.Scale.ScaleModes.FIT
        }
      }
      var game =  new Phaser.Game(config)
</script>
{% endblock script %}
