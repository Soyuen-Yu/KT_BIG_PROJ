{% extends "base.html" %}
{%load static%}
{% block script %}
<script>
  function preload ()
  {
      //bgs
      this.load.image('bg', "{% static '/resource//ui/background.jpg'%}")
      this.load.image('bg1', "{% static '/resource/ui//bg1.png'%}")
  
      //bodies
      this.load.image('body', "{% static '/resource/ui/character/character/body.png'%}")
      this.load.image('helmet', "{% static '/resource/ui/character/character/Hat-Helmet.png'%}")
      this.load.image('head', "{% static '/resource/ui/character/character/Head.png'%}")
      this.load.image('leftleg', "{% static '/resource/ui/character/character/Leg.png'%}")
      this.load.image('rightleg', "{% static '/resource/ui/character/character/Leg.png'%}")
      this.load.image('shield', "{% static '/resource/ui/character/character/Shield.png'%}")
      this.load.image('sword', "{% static '/resource/ui/character/character/Weapon-Sword.png'%}")
  
      //hairs
      
  
      //tops
      
  
      //bottoms
      //추후추가

  
      //shoes
      //추후추가

  
  
      //weapons
      //추후추가
    
  
      //UI
      this.load.image('back', "{% static '/resource/ui/back.png'%}");
      this.load.image('faceui', "{% static '/resource/ui/character/ui/얼굴밝기조절.png'%}");
      this.load.image('hairui', "{% static '/resource/ui/character/ui/헤어스타일.png'%}");
      this.load.image('colourui', "{% static '/resource/ui/character/ui/헤어컬러.png'%}");
      this.load.image('topui', "{% static '/resource/ui/character/ui/상의.png'%}");
      this.load.image('bottomui', "{% static '/resource/ui/character/ui/하의.png'%}");
      this.load.image('setui', "{% static '/resource/ui/character/ui/세트.png'%}");
      this.load.image('accessoryui', "{% static '/resource/ui/character/ui/액세사리.png'%}");
      this.load.image('shoesui', "{% static '/resource/ui/character/ui/신발.png'%}");
      this.load.image('selectui', "{% static '/resource/ui/character/ui/확정.png'%}");
  
  }
  
  
  function create ()
  {
      player = this.physics.add.staticGroup();
      ui = this.physics.add.staticGroup();
  
      this.add.image(150,300,'bg');
      this.add.image(100,300,'bg1').setScale(0.3);
      back = this.add.image(30,30,'back').setScale(0.3).setInteractive({cursor:'pointer'})

        back.on('pointerover', function(event){
            this.setTint(0x50bcdf)
        })
        back.on('pointerout', function(event){
            this.clearTint()
        })
        back.on('pointerdown', function(event){
            location.replace('http://localhost:8000/mainapp/main')
        })
        
     //UI options
     faceui = ui.create(100,100, 'faceui').setInteractive();
     hairui = ui.create(250,150, 'hairui').setInteractive();
     colourui = ui.create(250,190, 'colourui').setInteractive();
     topui = ui.create(250,230, 'topui').setInteractive();
     bottomui = ui.create(250,270, 'bottomui').setInteractive();
     setui = ui.create(250,310, 'setui').setInteractive();
     accessoryui = ui.create(250,350, 'accessoryui').setInteractive();
     shoesui = ui.create(250,390, 'shoesui').setInteractive();
     selectui = ui.create(250,520, 'selectui').setScale(0.7).setInteractive();

      //player
      x = 100;
      y = 300;
      leftleg = this.add.sprite(x-10, y+30, 'leftleg');
      rightleg = this.add.sprite(x+10, y+30, 'rightleg');
      body = this.add.sprite(x, y, 'body');
      head = this.add.sprite(x, y-50, 'head');
      //head.anchor.set(0, 1);
      helmet = this.add.sprite(x, y-70, 'helmet');
      //helmet.anchor.set(0, 1);
      shield = this.add.sprite(x-50, y, 'shield');
      //shield.anchor.set(0, 0.05);
      sword = this.add.sprite(x+40, y-10, 'sword');
      //sword.anchor.set(0, 0.05);
      sword.angle += 30;
      this.player.add(leftleg);
      this.player.add(rightleg);
      this.player.add(body);
      this.player.add(head);
      this.player.add(helmet);
      this.player.add(shield);
      this.player.add(sword);

      var swordTween = this.add.tween(sword).to({angle: 15}, 1400, Phaser.Easing.Linear.None, true, 0, -1, true);



  
  
      //colour tile objects
      red = smalltiles.create(695, 470, 'smalltile').setTint(0x85251B).setInteractive();      
      orange = smalltiles.create(725, 470, 'smalltile').setTint(0x874E0F).setInteractive();
      yellow = smalltiles.create(755, 470, 'smalltile').setTint(0xB2B037).setInteractive();
      green = smalltiles.create(785, 470, 'smalltile').setTint(0x4C7940).setInteractive();
      lightblue = smalltiles.create(815, 470, 'smalltile').setTint(0x7F9293).setInteractive();        
      darkblue = smalltiles.create(845, 470, 'smalltile').setTint(0x383A4B).setInteractive();
      purple = smalltiles.create(875, 470, 'smalltile').setTint(0x6F5F78).setInteractive();
      pink = smalltiles.create(905, 470, 'smalltile').setTint(0xD6A16B).setInteractive();     
      
      //player layers
      //playershirt;
      //playerpants;
      //playershoes;
      //playeraccessories;
      //playerbg;
  
  
      //MENU ICONS
  
      //hairs
      hairicon1 = this.add.image(735,185, 'hair1').setScale(0.2).setInteractive();
      hairicon2 = this.add.image(812,185, 'hair2').setScale(0.2).setInteractive();
      // hairicon3 = this.add.image(893,185, 'hair3').setScale(0.2).setInteractive();

  
  
      //MOUSE INTERACTIONS
  
      //click colour tiles
      red.on('pointerdown', function (pointer, red) { colour = 0x85251B; });
      orange.on('pointerdown', function (pointer, orange) { colour = 0x874E0F;  });
      yellow.on('pointerdown', function (pointer, yellow){ colour = 0xB2B037; });
      green.on('pointerdown', function(pointer, green){ colour = 0x4C7940; });
      lightblue.on('pointerdown', function(pointer, lightblue){ colour = 0x7F9293; });
      darkblue.on('pointerdown', function(pointer, darkblue){ colour = 0x383A4B;  });
      purple.on('pointerdown', function(pointer, purple){ colour = 0x6F5F78;  });
      pink.on('pointerdown', function(pointer, pink){ colour = 0xD6A16B; });
      
      //click menu text
      bodytxt.on('pointerdown', function (pointer, bodytxt) { selection = 1; page =0; });                
      hairstxt.on('pointerdown', function (pointer, hairstxt) { selection = 2; page = 0; playerhair });   
      toptxt.on('pointerdown', function (pointer, toptxt) { selection = 3; page = 0; playertop });   
      bottomtxt.on('pointerdown', function (pointer, bottomtxt) { selection = 4; page = 0; playerbottom });   
      shoestxt.on('pointerdown', function (pointer, shoestxt) { selection = 5; page = 0; playershoes });   
      weapontxt.on('pointerdown', function (pointer, weapontxt) { selection = 6; page = 0; playerweapon });   
      
  
      //click item icons
      hairicon1.on('pointerdown', function (pointer, hairicon1){ });
      hairicon2.on('pointerdown', function (pointer, hairicon2){ });
      hairicon3.on('pointerdown', function (pointer, hairicon3){ });
  
      //click arrows
      leftArrow.on('pointerdown', function(pointer, leftArrow){ page -= 1; });
      rightArrow.on('pointerdown', function(pointer, rightArrow){ page += 1; });
  
      //ANIMATIONS
      // var keys = ['cat', 'pupil', 'faceblink', 'gothblink', 'shiftyblink'];
      // var spritesheets = ['catbody','cateyes', 'catface', 'catfacegoth', 'catfaceshifty'];
  
      // for(var i = 0; i < keys.length; i++){
      //     this.anims.create({
      //         key: keys[i],
      //         frames: this.anims.generateFrameNumbers(spritesheets[i], { start: 0, end: 13 }),
      //         frameRate: 10,
      //         repeat: -1
      //     });
      // }

      this.input.on('gameobjectover', function(pointer, gameObject){
          gameObject.setTint(0x50bcdf)
      })

      this.input.on('gameobjectout', function(pointer, gameObject){
          gameObject.clearTint()
      })

      this.input.on('gameobjectdown', function(pointer, gameObject){
          var link = gameObject.texture.key
          link = 'http://localhost:8000/mainapp/' + String(link)
          location.replace(link)

      })

  }
  //end create
  
  
  
  
  
  //custom functions
  
  //helper function, sets individual icon to active/visible to inactive/invisible
  function setActivity(icon, bool){
      icon.input.enabled = bool;
      icon.setVisible(bool);
  }
  
  
  //Sets each item icon in an array to active/visible or inactive/invisible
  function setAllActivity(array, bool){    
      for(var i = 0; i < array.length; i++){
          setActivity(array[i], bool);
      }
  }
  
  //Displays the desired item menu icons as listed in the current page
  function setJustOne(all, desired, page){
      //i = icon category index
      for(var i = 0; i < all.length; i++){
          //j = array for each page of icons
          for(var j = 0; j < all[i].length; j++){
              if(all[i] != desired || j != page){
                  setAllActivity(all[i][j], false);
              }
              if(all[i] == desired && j == page){
                  setAllActivity(all[i][j], true);
              }
          }
      }
  }
  
  
  //tints text icon and clears tint from all other text icons
  function selected(icon, array){
      for(var i = 0; i < array.length; i++){
          if(array[i] != icon){
              array[i].clearTint()
          }
          if(array[i] == icon){
              array[i].setTint(0xff0000);
          }
      }
  }
  
  //plays the animation key given to the player body
  function playBody(bodyKey){
      player.anims.play(bodyKey, true);
  }
  
  //plays the animation key given to the player's face
  function playFace(facekey){
      playerface.anims.play(facekey, true);
      playereyes.anims.play('pupil', true);
  }
  
  //helper function for menuOptions(). Ensures page index does not go out of bounds.
  function pageCtrl(page, max){
      if(page >= max){
          this.page = max;
      }
      if (page <= 0){
          this.page = 0;
      }
  }
  
  
  //When user clicks any text section it triggers displaying of relevant item icons.  
  function menuOptions(selection){
      
      //icon arrays 
      //2D, bodyIcons[0] = first page array, bodyIcons[0][0] = first item on first page 
      var bodyIcons = [ [], [], [] ];
      var hairIcons = [[hairicon1, hairicon2, hairicon3], [], [] ];
      var topIcons = [ [], [], [] ];
      var bottomIcons = [ [], [], []];
      var shoesIcons= [ [], [], []];
      var weaponIcons= [ [], [], [] ];
  
      //3D array 
      //allIcons[0] = bodyIcons, allIcons[0][0] = First page, allIcons [0][0][0] = first elem in first page 
      var allIcons = [bodyIcons, hairIcons, topIcons, bottomIcons, shoesIcons, weaponIcons]; 
  
      //just an array of interactive text objects.
      var textIcons = [bodytxt, hairtxt, toptxt, bottomtxt, shoestxt, weapontxt];
  
  
  
      //body selection
      if(selection == 1){  
          currentobj = player;
          selected(bodytxt, textIcons);
          pageCtrl(page, bodyIcons.length);
          console.log('selection 1 page:' + page);
          setJustOne(allIcons, bodyIcons, page);
      }
      //hair selection
      if(selection == 2){
          currentobj = playehair;
          selected(hairtxt, textIcons);
          pageCtrl(page, hairIcons.length);
          console.log('selection 2 page:' + page);
          setJustOne(allIcons, hairIcons, page);
      }
      //top section
      if(selection == 3){
          currentobj = top;
          selected(toptxt, textIcons);
          pageCtrl(page, topIcons.length);
          console.log('selection 3 page:' + page);
          setJustOne(allIcons, topIcons, page);
      }
      //bottom section
      if(selection == 4){
          //currentobj = bottom;
          selected(bottomtxt, textIcons);
          pageCtrl(page, bottomIcons.length);
          console.log('selection 4 page:' + page);
          setJustOne(allIcons, bottomIcons, page);
      }
      //shoes section
      if(selection == 5){
          //currentobj = shoes;
          selected(shoestxt, textIcons);
          pageCtrl(page, shoesIcons.length);
          console.log('selection 5 page:' + page);
          setJustOne(allIcons, shoesIcons, page);
      }
      //weapon section
      if(selection == 6){
          //currentobj = weapon;
          selected(weapontxt, textIcons);
          pageCtrl(page, weaponIcons.length);
          console.log('selection 6 page:' + page);
          setJustOne(allIcons, weaponIcons, page);
      }
  }
  
  var colour = 0x85251B;
  var selection = 1;
  var currentobj;
  // facekey = 'shiftyblink';
  // bodyKey = 'cat'
  var page = 0;
  
  //Game Main
  function update ()
  { 
      //sprite layers
      // playBody(bodyKey);                    //body
      // playFace(facekey);                    //face/ eyes
  
      menuOptions(selection);               //select section
      currentobj.setTint(colour);           //tint section
      
  }
  
  
  
  var config = {
    type: Phaser.AUTO,
    width: 300,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            debug: false,
            gravity: {
                y: 0
            }
        }
    },
    backgroundColor: '#2d2d2d',
    scene: {
      preload: preload,
      create: create,
      update:update,
    },
    scale: {
        mode: Phaser.Scale.ScaleModes.FIT
    }
  }
  var game =  new Phaser.Game(config)
</script>
{% endblock script %}
